@page "/u/{userId:int}"
@using System.Globalization
@using Oldsu
@using Oldsu.Types
@using Oldsu.Web.Utils


@{
    Layout = "BaseLayoutWithBanner";
    StatsWithRank userStats = Model.UserStats;
    UserPage userPage = Model.UserPageInfo;

    string GetCommaSeparatedNumber(ulong n) => n.ToString("N0", new CultureInfo("en-US"));
    
    // yoinked and adapted from https://stackoverflow.com/a/4127477
    int GetAge(DateTime start) {
        DateTime now = DateTime.Now;
        
        return now.Year - start.Year - 1 +
               (now.Month > start.Month ||
                now.Month == start.Month && now.Day >= start.Day ? 1 : 0);
    }
    
}

<script src="/resources/js/user_level_calc.js"></script>
<script id="stats" type="application/json">@Json.Serialize(new { totalScore = userStats.TotalScore })</script>

@model Oldsu.Web.Pages.UserPage

<div class="user_content">
    <div class="user_card-info_wrapper">
        <div class="user_card">
            <h2 class="user_card_name">@(userStats.User.Username)</h2>
            <img src="/resources/image/avatar_placeholder.png" alt="@(userStats.User.Username)'s avatar" class="user_card_avatar" width="128px" height="128px">
            <div class="user_card_badges_wrapper">
                @{
                    if(userStats.Rank == 1) {
                        <img src="/resources/image/1Badge.png" alt="#1 Badge" class="user_card_badge">
                    }
                }
            </div>
            <h3 class="user_card_player_title">@userPage.Title</h3>
            <div class="user_card_ranking">
                <img class="user_card_ranking_flag" src="@userStats.User.FlagBaseUrl" alt="Country: @CountryCodes.FromCode[userStats.User.Country]" height="48px">
                <div class="user_card_ranking_values_wrapper">
                    <h3 class="user_card_ranking_rank">Rank #@GetCommaSeparatedNumber(userStats.Rank)</h3>
                    <h3 class="user_card_ranking_level" id="user_card_ranking_level">Level @userStats.UserLevel</h3>
                </div>
            </div>
        </div>
        <div class="user_info">
            @{ if(userPage.Birthday != null) { <h5 class="user_info_age">Age: @GetAge((DateTime)userPage.Birthday)</h5> } }
            @{ if(!string.IsNullOrEmpty(userPage.Occupation)) { <h5 class="user_info_occupation">Occupation: @(userPage.Occupation)</h5> } }
            @{ if(!string.IsNullOrEmpty(userPage.Interests)) { <h5 class="user_info_interests">Interests: @(userPage.Interests)</h5> } }
            @{ if(!string.IsNullOrEmpty(userPage.Website)) { <h5 class="user_info_website">Website: <a href="@userPage.Website">@(userPage.Website)</a></h5> } }
            @{ if(!string.IsNullOrEmpty(userPage.Twitter)) { <h5 class="user_info_twitter">Twitter: @(userPage.Twitter)</h5> } }
            @{ if(!string.IsNullOrEmpty(userPage.Discord)) { <h5 class="user_info_discord">Discord: @(userPage.Discord)</h5> } }
            <h4 class="user_info_joindate">Joined: @userStats.User.JoinedAt.ToShortDateString()</h4>
        </div>
    </div>
    <div class="user_stat_wrapper">
        <div class="user_stat_info">
            <div class="user_stat_heading_wrapper">
                <h4 class="user_stat_heading">Information for: osu! Standard</h4>
            </div>
            <div class="user_stat_info_rankgraph">
                <span class="user_stat_info_rankgraph_text">Ranking Graph</span>
            </div>
            <div class="user_stat_info_values">
                <h5 class="user_stat_info_value_title">Total Playtime:</h5>
                <h5 class="user_stat_info_value_number">0s</h5>
                <h5 class="user_stat_info_value_title">Ranked Score:</h5>
                <h5 class="user_stat_info_value_number">@GetCommaSeparatedNumber(userStats.RankedScore)</h5>
                <h5 class="user_stat_info_value_title">Accuracy:</h5>
                <h5 class="user_stat_info_value_number">@($"{userStats.Accuracy:.##}")%</h5>
                <h5 class="user_stat_info_value_title">Playcount:</h5>
                <h5 class="user_stat_info_value_number">@GetCommaSeparatedNumber(userStats.Playcount)</h5>
                <h5 class="user_stat_info_value_title">Medals:</h5>
                <h5 class="user_stat_info_value_number">0</h5>
            </div>
            <div class="user_stat_info_ranks">
                <h5 class="silv_SS_rank_text">SS</h5>
                <h5 class="silv_SS_rank_value">@GetCommaSeparatedNumber(userStats.CountSSH)</h5>
                <h5 class="gold_SS_rank_text">SS</h5>
                <h5 class="gold_SS_rank_value">@GetCommaSeparatedNumber(userStats.CountSS)</h5>
                <h5 class="silv_S_rank_text">S</h5>
                <h5 class="silv_S_rank_value">@GetCommaSeparatedNumber(userStats.CountSH)</h5>
                <h5 class="gold_S_rank_text">S</h5>
                <h5 class="gold_S_rank_value">@GetCommaSeparatedNumber(userStats.CountS)</h5>
                <h5 class="A_rank_text">A</h5>
                <h5 class="A_rank_value">@GetCommaSeparatedNumber(userStats.CountA)</h5>
            </div>
        </div>
        <div class="user_stat_wrapper">
            <div class="user_stat_info">
                <div class="user_stat_heading_wrapper">
                    <h4 class="user_stat_heading">Signature</h4>
                </div>
                <div class="user_signature_text_wrapper">
                    <p class="user_signature_text">@Html.Raw(BBCodeHelper.Format(userPage.BBText ?? string.Empty))</p>
                </div>
            </div>
        </div>
        <div class="user_stat_wrapper">
            <div class="user_stat_fp">
                <div class="user_stat_heading_wrapper">
                    <h4 class="user_stat_heading">First Places</h4>
                </div>
                <div class="first_places_wrapper">
                    <div class="first_place_content">
                        <div class="first_place_metadata-bg_wrapper">
                            <img class="first_place_bg" src="/resources/image/discoprincebg.jpg" alt="Artist - Title (by Mapper)">
                            <div class="first_place_metadata_wrapper">
                                <span class="first_place_metadata">Artist - Title (by Mapper)</span>
                                <span class="first_place_diff">[Difficulty]</span>
                            </div>
                        </div>
                        <div class="first_place_score_details">
                            <div class="first_place_rank">
                                <img class="first_place_rank_image" src="/resources/image/ranks/gl_SS.png">
                            </div>
                            <span class="first_place_score_acc">00.00%</span>
                            <span class="first_place_score_mods">HD DT HR FL</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var stats = JSON.parse(document.getElementById("stats").textContent);
    document.getElementById("user_card_ranking_level").textContent = `Level: ${calcLevelPrecise(stats.totalScore).toFixed(0)}`
</script>